<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<!--Compute Shader Base-->
  
  <style type="text/css">table {
        line-height:160%; FONT-SIZE: 11pt; MARGIN: 0px; FONT-FAMILY: 맑은 고딕, 바탕, Courier New, Courier
}
  </style>
  
  <style type="text/css">div {
        line-height:130%; font-family:돋움체; font-size:10pt; color:black; background-color:white; padding:0pt; border-width:1pt; border-color:black; border-style:solid
}
  </style>
  
  <style type="text/css">
	li {
          margin: 10px 0;
        }

        li:last-child {
           margin-bottom: 0;
        }
  </style>
  
  <meta name="GENERATOR" content="Namo WebEditor v6.0">

  
  <meta charset="UTF-8">
  <title>Compute Shader Base</title>

  
<!-- Google tag (gtag.js) -->
  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Z0ZXNX5CYQ"></script>
  
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-Z0ZXNX5CYQ');
  </script>
</head><body>
<h1>Compute Shader Base<br>
</h1>

<table border="0" width="700">

  <tbody>
    <tr>
      <td>컴퓨터 셰이더는 렌더링 파이프라인에 포함 되지 않는 셰이더로 GPU의 병렬 처리 능력을 활용하여 물리 계산, AI, 이미지 처리, 시뮬레이션등에 사용 할수 있습니다.<br>
      <br>
유니티에서는 .compute 이름으로 저장이 되며, HLSL(High-Level Shader Language)을 사용 합니다.<br>
      <br>
      <h3>컴퓨터 셰이더의 기본 구조</h3>
      <br>
Computer Shader의 기본 구조에 대해서 알아 보겠습니다.<br>
      <br>
      <div>#pragma kernel CSMain<br>
      <br>
[numthreads(8, 8, 1)]<br>
void CSMain (uint3 id : SV_DispatchThreadID)<br>
{<br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// GPU에서 실행될 코드</span><br>
}<br>
      </div>
      <br>
krnel<br>
      <ul>
        <li>GPU에서 실행되는 하나의 "진입 함수(entry point)"를 의미합니다.</li>
        <li>각 커널은 GPU에서 병렬로 실행될 작업 단위입니다.</li>
        <li>여기서는 CSMain이 커널 이름입니다.<br>
        </li>
        <li>커널은 한파일안에 여러개 정의 할수 있습니다.</li>
      </ul>
      <br>
여러개 정의한 예<br>
      <div>#pragma kernel Init<br>
#pragma kernel Update<br>
      <br>
RWStructuredBuffer&lt;float&gt; data;<br>
      <br>
[numthreads(64, 1, 1)]<br>
void Init(uint id : SV_DispatchThreadID)<br>
{<br>
&nbsp;&nbsp;&nbsp; data[id] = 0.0;<br>
}<br>
      <br>
[numthreads(64, 1, 1)]<br>
void Update(uint id : SV_DispatchThreadID)<br>
{<br>
&nbsp;&nbsp;&nbsp; data[id] += 1.0;<br>
}<br>
      </div>
      <br>
C#에서 컴퓨터 셰이더 실행 하기<br>
      <br>
      <div>public ComputeShader shader;&nbsp; <span style="color: rgb(0, 153, 0);">//인스펙트에서 .compute 셰이더 파일 드래그</span><br>
      <br>
int kernel = computeShader.FindKernel("CSMain");<br>
computeShader.Dispatch(kernel, 10, 10, 1);<br>
      </div>
      <br>
커널을 찾고 Dispatch로 함수를 실행한다.<br>
Dispatch는 "GPU에게 이 커널을 몇 개의 Thread Group으로 실행할지 지시하는 명령"입니다.<br>
      <br>
      <span style="font-weight: bold;">Dispatch 함수</span><br>
      <br>
첫번째 파라메터: 커널(kernel)<br>
두번째, 세번째, 네번째 파라메터 : Thread Group의 개수 (X, Y, Z)<br>
      <br>
셰이더에 있는 다음의 숫자는 그룹안에서 실행되는 쓰레드의 갯수입니다.<br>
여기서는 8*8*1로 64개의 쓰레드<br>
      <br>
      <span style="color: rgb(51, 51, 255);">[numthreads(8, 8, 1)]</span><br>
      <br>
Dispatch에서는 Group 50개 실행<br>
      <span style="color: rgb(51, 51, 255);"><br>
Dispatch(10, 5, 1); </span><br>
      <br>
총 64 × 50 = 3200 쓰레드<br>
1) SV_GroupThreadID<br>
그룹 Thread ID<br>
범위: 0 ~ numthreads-1<br>
      <br>
2) SV_GroupID<br>
그룹 ID<br>
범위: 0 ~ Dispatch-1<br>
      <br>
3) SV_DispatchThreadID (가장 중요)<br>
전체 기준 전역 ID<br>
계산식은 다음과 같다.<br>
      <br>
      <span style="color: rgb(51, 51, 255);">SV_DispatchThreadID = SV_GroupID * numthreads + SV_GroupThreadID</span><br>
      <br>
<br>
      </td>
    </tr>
  </tbody>
</table>

<p>&nbsp;</p>

<p>&nbsp;</p>

<script language="JavaScript">

var images = document.getElementsByTagName('img'); 

for(var i = 0; i < images.length; i++) { 
    images[i].style.width = images[i].width/2 + 'px';
    images[i].style.height = images[i].height/2 + 'px';
    images[i].addEventListener("click", ChangeImageSize.bind(images[i]), false);
    images[i].setAttribute('data-imageSize', '0.5');
}

function ChangeImageSize(){
    imageSize = this.getAttribute('data-imageSize')

    width = this.width;
    height = this.height;

    if(imageSize == '1') 
    {
	this.setAttribute('data-imageSize', '0.5');
        width =  width/2;
        height = height/2;      
    }
    else 
    {
	this.setAttribute('data-imageSize', '1');
        width = width*2;
        height = height*2;
    }

    this.style.width = width + 'px';
    this.style.height = height + 'px';
}

</script>
</body></html>