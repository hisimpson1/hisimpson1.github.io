<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<!--URP shader toggle-->
  
  <style type="text/css">table {
        line-height:160%; FONT-SIZE: 11pt; MARGIN: 0px; FONT-FAMILY: 맑은 고딕, 바탕, Courier New, Courier
}
  </style>
  
  <style type="text/css">div {
        line-height:130%; font-family:돋움체; font-size:10pt; color:black; background-color:white; padding:0pt; border-width:1pt; border-color:black; border-style:solid
}
  </style>
  
  <style type="text/css">
	li {
          margin: 10px 0;
        }

        li:last-child {
           margin-bottom: 0;
        }
  </style>
  
  <meta name="GENERATOR" content="Namo WebEditor v6.0">

  
  <meta charset="UTF-8">
  <title>URP shader toggle</title>

  
<!-- Google tag (gtag.js) -->
  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Z0ZXNX5CYQ"></script>
  
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-Z0ZXNX5CYQ');
  </script>
</head><body>
<h1>URP shader toggle<br>
</h1>

<table border="0" width="700">

  <tbody>
    <tr>
      <td>shader_feature 지시어로 토글(체크박스)로 셰이더의 기능을 On/Off 할수 있습니다.<br>
      <br>
메테리얼 인스펙터에서 체크박스를 끄면, 유니티는 실행 시점에 불필요한 연산을 전혀 하지 않게 됩니다.<br>
체크 된것과 체크 안된것을 비교 하려면 메트리얼을 2개 만들어서 하나는 체크된 버전, 하나는 체크 안된 버전의 메트리얼을 준비 해야 합니다.<br>
      <br>
다음 예제는 텍스쳐를 적용 할지, 안할지 토글하여 선택 할수 있습니다.<br>
      <br>
1. 퍼로퍼티 추가<br>
      <br>
[Toggle] 속성을 사용하여 인스펙터에 체크박스를 생성합니다.<br>
괄호 안의 _USE_TEX_ON은 실제 셰이더 키워드 이름이 됩니다.<br>
      <br>
      <div>&nbsp;&nbsp;&nbsp; Properties<br>
&nbsp;&nbsp;&nbsp; {<br>
      <span style="color: rgb(0, 0, 153); font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(51, 51, 255);">[Toggle(_USE_TEX_ON)] _UseTex ("Use Texture?", Float) = 1.0</span></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _BaseMap("BaseMap", 2D) = "white" {}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _BaseColor("Base Color (Fallback)", Color) = (1, 1, 1, 1)<br>
&nbsp;&nbsp;&nbsp; }<br>
      <br>
      <br>
      </div>
      <br>
      <br>
2. 셰이더 키워드 선언 (텍스처 사용 여부 분기)<br>
      <div>&nbsp;&nbsp;&nbsp; Pass<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HLSLPROGRAM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #pragma vertex vert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #pragma fragment frag<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(51, 51, 255); font-weight: bold;">#pragma shader_feature _USE_TEX_ON</span><br>
      </div>
      <br>
shader_feature는 유니티 셰이더에서 특정 기능(예: 텍스처 사용 여부, 프레넬 활성화 등)을 선택적으로 포함하거나 제외할 때 사용하는 지시어입니다.<br>
      <ul>
        <li>shader_feature는 메테리얼 설정에 따라 불필요한 셰이더 코드를 제거하여 성능을 높여줍니다.</li>
        <li>빌드 시 실제로 사용되는 조합만 포함하므로 용량이 가벼워집니다.</li>
        <li style="color: rgb(204, 0, 0);">단, 런타임에 스크립트로 갑자기 키워드를 켜려고 하면 빌드에서 누락되어 에러가 날 수 있으니 주의해야 합니다.</li>
      </ul>
      <br>
<br>
      3. 체크박스가 켜져 있을 때만 텍스처를 샘플링합니다.<br>
      <div>half3 frag(Varyings IN) : SV_Target<br>
{<br>
&nbsp;&nbsp;&nbsp; ......<br>
      <br>
&nbsp;&nbsp;&nbsp; #if defined(_USE_TEX_ON)<br>
&nbsp; &nbsp; &nbsp;&nbsp; albedo *= SAMPLE_TEXTURE2D(_BaseMap, sampler_BaseMap, TRANSFORM_TEX(IN.uv, _BaseMap)).rgb;<br>
&nbsp;&nbsp;&nbsp; #endif<br>
      <br>
&nbsp;&nbsp;&nbsp; .....<br>
&nbsp;&nbsp;&nbsp; return color; <br>
}<br>
      </div>
      <br>
      <br>
결론)&nbsp; 런타임과 빌드시 사용은 안하는게 좋겠습니다.<br>
      <span style="color: rgb(204, 0, 0); font-weight: bold;">셰이더 변종(Variant) 유실 (빌드 시 문제)</span><br>
      <br>
에디터에서는 잘 작동하는데, 실제 폰이나 PC로 빌드했을 때 토글이 작동하지 않고 핑크색이나 검은색으로 나오는 경우가 있습니다.<br>
      <ul>
        <li>유니티는 빌드할 때 "사용되지 않는 키워드 조합"은 용량을 줄이기 위해 삭제합니다.</li>
        <li>만약 처음에 모든 메테리얼이 토글을 끄고 있었다면, 유니티는 "토글이 켜진 버전"의 셰이더를 빌드에서 빼버릴 수 있습니다.</li>
        <li>해결책: Project Settings &gt; Graphics &gt; Shader Stripping 설정을 확인하거나, 해당 키워드가 사용된 메테리얼을 씬에 하나쯤은 배치해두어야 합니다.</li>
      </ul>
      <br>
UnlitShaderBasic_toggle.shader 파일<br>
      <div>Shader "Custom/UnlitShaderBasic_toggle"<br>
{<br>
&nbsp;&nbsp;&nbsp; Properties<br>
&nbsp;&nbsp;&nbsp; {<br>
      <span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // [Toggle] 속성을 사용하여 인스펙터에 체크박스를 생성합니다.</span><br style="color: rgb(0, 153, 0);">
      <span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 괄호 안의 _USE_TEX_ON은 실제 셰이더 키워드 이름이 됩니다.</span><br style="color: rgb(0, 153, 0);">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Toggle(_USE_TEX_ON)] _UseTex ("Use Texture?", Float) = 1.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _BaseMap("BaseMap", 2D) = "white" {}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _BaseColor("Base Color (Fallback)", Color) = (1, 1, 1, 1)<br>
&nbsp;&nbsp;&nbsp; }<br>
      <br>
&nbsp;&nbsp;&nbsp; SubShader<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tags { "RenderType" = "Opaque" "RenderPipeline" = "UniversalPipeline" }<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pass<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HLSLPROGRAM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #pragma vertex vert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #pragma fragment frag<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 셰이더 키워드 선언 (텍스처 사용 여부 분기)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #pragma shader_feature _USE_TEX_ON<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
#include
"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
#include
"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"
      <br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct Attributes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float4 positionOS&nbsp;&nbsp; : POSITION;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float2
uv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :
TEXCOORD0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float3 normalOS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : NORMAL;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct Varyings<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float4 positionHCS&nbsp; : SV_POSITION;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float2
uv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :
TEXCOORD0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float3 normalWS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : NORMAL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEXTURE2D(_BaseMap);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SAMPLER(sampler_BaseMap);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CBUFFER_START(UnityPerMaterial)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; float4 _BaseMap_ST;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; half4 _BaseColor;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CBUFFER_END<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Varyings vert(Attributes IN)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Varyings OUT;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OUT.uv = IN.uv;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// Normal 변환 시 TransformObjectToWorldNormal을 사용하는 것이 더 정확합니다.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
OUT.normalWS = TransformObjectToWorldNormal(IN.normalOS);&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return OUT;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; half3 frag(Varyings IN) : SV_Target<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 1. 조명 데이터 가져오기</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Light light = GetMainLight();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float3 lightDir = normalize(light.direction);&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float3 normalWS = normalize(IN.normalWS); <br>
&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 2. 조명 계산 (NdotL)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float NdotL = saturate(dot(normalWS, lightDir));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float3 directLight = NdotL * light.color * light.shadowAttenuation;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; half3 ambient = unity_AmbientSky.rgb;<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 3. 알베도(색상) 결정 (토글 분기)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; half3 albedo = _BaseColor.rgb;<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #if defined(_USE_TEX_ON)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 체크박스가 켜져 있을 때만 텍스처를 샘플링합니다.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
albedo *= SAMPLE_TEXTURE2D(_BaseMap, sampler_BaseMap,
TRANSFORM_TEX(IN.uv, _BaseMap)).rgb;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endif<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// 4. 최종 색상 조합</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
half3 color = albedo * (directLight + ambient);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return color; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ENDHLSL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
      </div>
      <br>
"Use Texture"를 토글 하여, 텍스쳐를 적용 할수 있습니다.<br>
      <br>
      <img style="width: 534px; height: 486px;" alt="" src="tutorial02/toggle.png"><br>
      <br>
<br>
      </td>
    </tr>
  </tbody>
</table>

<p>&nbsp;</p>

<p>&nbsp;</p>

<script language="JavaScript">

var images = document.getElementsByTagName('img'); 

for(var i = 0; i < images.length; i++) { 
    images[i].style.width = images[i].width/2 + 'px';
    images[i].style.height = images[i].height/2 + 'px';
    images[i].addEventListener("click", ChangeImageSize.bind(images[i]), false);
    images[i].setAttribute('data-imageSize', '0.5');
}

function ChangeImageSize(){
    imageSize = this.getAttribute('data-imageSize')

    width = this.width;
    height = this.height;

    if(imageSize == '1') 
    {
	this.setAttribute('data-imageSize', '0.5');
        width =  width/2;
        height = height/2;      
    }
    else 
    {
	this.setAttribute('data-imageSize', '1');
        width = width*2;
        height = height*2;
    }

    this.style.width = width + 'px';
    this.style.height = height + 'px';
}

</script>
</body></html>